rguments),mu.add(this)}async unwrap(e,r,n=this._client.webhookSecret,s=300){return await this.verifySignature(e,r,n,s),JSON.parse(e)}async verifySignature(e,r,n=this._client.webhookSecret,s=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");E(this,mu,"m",Lq).call(this,n);let i=F([r]).values,o=E(this,mu,"m",cg).call(this,i,"webhook-signature"),a=E(this,mu,"m",cg).call(this,i,"webhook-timestamp"),u=E(this,mu,"m",cg).call(this,i,"webhook-id"),c=parseInt(a,10);if(isNaN(c))throw new Ln("Invalid webhook timestamp format");let l=Math.floor(Date.now()/1e3);if(l-c>s)throw new Ln("Webhook timestamp is too old");if(c>l+s)throw new Ln("Webhook timestamp is too new");let p=o.split(" ").map(g=>g.startsWith("v1,")?g.substring(3):g),d=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),f=u?`${u}.${a}.${e}`:`${a}.${e}`,m=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let g of p)try{let v=Buffer.from(g,"base64");if(await crypto.subtle.verify("HMAC",m,v,new TextEncoder().encode(f)))return}catch{continue}throw new Ln("The given webhook signature does not match the expected signature")}};mu=new WeakSet,Lq=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},cg=function(e,r){if(!e)throw new Error("Headers are required");let n=e.get(r);if(n==null)throw new Error(`Missing required header: ${r}`);return n};var $S,US,ug,Fq,se=class{constructor({baseURL:e=mi("OPENAI_BASE_URL"),apiKey:r=mi("OPENAI_API_KEY"),organization:n=mi("OPENAI_ORG_ID")??null,project:s=mi("OPENAI_PROJECT_ID")??null,webhookSecret:i=mi("OPENAI_WEBHOOK_SECRET")??null,...o}={}){if($S.add(this),ug.set(this,void 0),this.completions=new Oo(this),this.chat=new pi(this),this.embeddings=new No(this),this.files=new qo(this),this.images=new Fo(this),this.audio=new zn(this),this.moderations=new $o(this),this.models=new Bo(this),this.fineTuning=new yn(this),this.graders=new bi(this),this.vectorStores=new Ps(this),this.webhooks=new zo(this),this.beta=new gn(this),this.batches=new Eo(this),this.uploads=new wi(this),this.responses=new Ts(this),this.realtime=new Ss(this),this.conversations=new yi(this),this.evals=new vi(this),this.containers=new gi(this),this.videos=new Uo(this),r===void 0)throw new K("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let a={apiKey:r,organization:n,project:s,webhookSecret:i,...o,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&J6())throw new K(`It looks like you're running in a browser-like environment.
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:171:5)
    at node:internal/main/run_main_module:36:49
Node.js v22.22.0